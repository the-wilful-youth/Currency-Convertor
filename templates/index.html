<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real-Time Currency Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body
    class="bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center min-h-screen"
  >
    <div
      class="bg-white p-8 rounded-2xl shadow-2xl w-96 text-center border-4 border-blue-300"
    >
      <h2 class="text-4xl font-extrabold text-gray-900 mb-6">
        Currency Converter
      </h2>

      <div class="mb-6">
        <label class="block text-gray-700 font-semibold text-lg">Amount:</label>
        <input
          type="number"
          id="amount"
          class="w-full p-4 border-2 border-gray-300 rounded-lg focus:ring-4 focus:ring-blue-500 text-lg text-gray-800"
          placeholder="Enter amount"
        />
      </div>

      <div class="mb-6">
        <label class="block text-gray-700 font-semibold text-lg">From:</label>
        <select
          id="from_currency"
          class="w-full p-4 border-2 border-gray-300 rounded-lg focus:ring-4 focus:ring-blue-500 text-lg text-gray-800"
        ></select>
      </div>

      <div class="text-center mb-6">
        <button
          onclick="swapCurrencies()"
          class="bg-gray-200 p-3 rounded-full shadow-md hover:bg-gray-300 transition"
        >
          ðŸ”„
        </button>
      </div>

      <div class="mb-6">
        <label class="block text-gray-700 font-semibold text-lg">To:</label>
        <select
          id="to_currency"
          class="w-full p-4 border-2 border-gray-300 rounded-lg focus:ring-4 focus:ring-blue-500 text-lg text-gray-800"
        ></select>
      </div>

      <button
        onclick="convert()"
        class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 rounded-xl text-xl font-bold shadow-lg hover:opacity-90 transition"
      >
        Convert
      </button>

      <h3
        id="result"
        class="text-3xl font-bold text-gray-900 mt-6 p-4 bg-gray-100 rounded-xl shadow-md"
      >
        Converted Amount:
      </h3>
      <p id="conversion_rate" class="text-lg text-gray-600 mt-2"></p>
    </div>

    <script>
      async function loadCurrencies() {
        try {
          const response = await fetch("/currencies");
          const data = await response.json();

          if (!data.currencies) {
            throw new Error("Invalid currency data received.");
          }

          const fromCurrency = document.getElementById("from_currency");
          const toCurrency = document.getElementById("to_currency");

          fromCurrency.innerHTML =
            '<option value="" disabled selected>Select Currency</option>';
          toCurrency.innerHTML =
            '<option value="" disabled selected>Select Currency</option>';

          for (const [code, rate] of Object.entries(data.currencies)) {
            fromCurrency.appendChild(new Option(code, code));
            toCurrency.appendChild(new Option(code, code));
          }
        } catch (error) {
          console.error("Error loading currencies:", error);
        }
      }

      async function convert() {
        const amount = document.getElementById("amount").value;
        const fromCurrency = document.getElementById("from_currency").value;
        const toCurrency = document.getElementById("to_currency").value;

        if (!amount || !fromCurrency || !toCurrency) {
          alert("Please fill in all fields.");
          return;
        }

        try {
          const response = await fetch(
            `/convert?from=${fromCurrency}&to=${toCurrency}&amount=${amount}`
          );
          const data = await response.json();

          if (data.error) {
            throw new Error(data.error);
          }

          document.getElementById(
            "result"
          ).innerText = `Converted Amount: ${data.converted_amount} ${toCurrency}`;
          document.getElementById(
            "conversion_rate"
          ).innerText = `Exchange Rate: 1 ${fromCurrency} = ${data.exchange_rate} ${toCurrency}`;
        } catch (error) {
          console.error("Conversion error:", error);
          document.getElementById("conversion_rate").innerText =
            "Failed to fetch exchange rate.";
        }
      }

      function swapCurrencies() {
        const fromCurrency = document.getElementById("from_currency");
        const toCurrency = document.getElementById("to_currency");
        [fromCurrency.value, toCurrency.value] = [
          toCurrency.value,
          fromCurrency.value,
        ];
      }

      loadCurrencies();
    </script>
  </body>
</html>
